@model BasketWorld.Models.Reservation
@{
    ViewData["Title"] = "Confirmation";

    // premiÃ¨re ligne complÃ¨tement peuplÃ©e
    var line = Model?.Lines?.FirstOrDefault(l =>
        l != null &&
        l.TicketOffer != null &&
        l.TicketOffer.Game != null &&
        l.TicketOffer.SeatCategory != null
    );
    var game = line?.TicketOffer?.Game;
}

@if (Model == null)
{
    <div class="alert alert-warning">RÃ©servation introuvable.</div>
}
else if (line == null || game == null)
{
    <div class="alert alert-warning">
        La rÃ©servation @Model.Id est incomplÃ¨te.
        <div class="mt-2">
            <a class="btn btn-outline-warning" asp-controller="Home" asp-action="Index">â¬… Retour Ã  l'accueil</a>
        </div>
        <div class="mt-3 small text-muted">Debug: Lines=@(Model.Lines?.Count ?? 0)</div>
    </div>
}
else
{
    <div class="text-center mb-4">
        <h1 class="text-warning">Merci ðŸŽ‰</h1>
        <p>Votre rÃ©servation est confirmÃ©e.</p>
    </div>

    <div class="card bg-dark text-white border border-warning shadow-lg p-4 mx-auto" style="max-width: 800px;">
        <div class="mb-3">
            <div><strong>RÃ©f :</strong> @Model.Id</div>
            <div><strong>Statut :</strong> @Model.Status</div>
        </div>

        <hr class="border-warning opacity-50" />

        <div class="mb-3">
            <div class="fs-5">
                <strong>@(game.HomeTeam?.Name ?? "â€”")</strong>
                <span class="text-secondary">vs</span>
                <strong>@(game.AwayTeam?.Name ?? "â€”")</strong>
                <span class="text-secondary">(@(game.League?.Name ?? "â€”"))</span>
            </div>
            <div>@game.StartAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm") â€” @(game.Venue ?? "â€”")</div>
        </div>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="card bg-dark text-white border border-warning p-3 h-100">
                    <div><span class="text-secondary">CatÃ©gorie :</span> <strong>@(line.TicketOffer.SeatCategory?.Name ?? "â€”")</strong></div>
                    <div><span class="text-secondary">QuantitÃ© :</span> <strong>@line.Quantity</strong></div>
                    <div><span class="text-secondary">Prix unitaire :</span> <strong>@line.UnitPrice â‚¬</strong></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-dark text-white border border-warning p-3 h-100 d-flex justify-content-center">
                    <div class="fs-4 text-center">
                        Total : <strong class="text-warning">@Model.TotalAmount â‚¬</strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a asp-controller="Home" asp-action="Index" class="btn btn-warning text-dark fw-bold">Retour Ã  lâ€™accueil</a>
        </div>
    </div>
}
