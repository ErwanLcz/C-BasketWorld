@* Views/Games/Details.cshtml *@
@model Game
@{
    var hasAccess = (bool)(ViewBag.HasAccess ?? false);
    var canWatchFromUtc = (DateTime)(ViewBag.CanWatchFromUtc ?? Model.StartAt);
    var canWatchFromLocal = canWatchFromUtc.ToLocalTime();
    bool canWatchNow = DateTime.UtcNow >= canWatchFromUtc;
}

<div class="card bg-dark text-white border border-warning shadow-lg p-4 mx-auto" style="max-width: 1000px;">
    <h1 class="card-title text-center mb-4" style= "color: var(--orange)">
        @Model.HomeTeam.Name <span class="text-secondary">vs</span> @Model.AwayTeam.Name
    </h1>

    <div class="d-flex justify-content-center align-items-center gap-3 mb-3">
        <img src="@(Url.Content(Model.HomeTeam.LogoUrl ?? "~/images/logos/default.png"))"
            alt="@Model.HomeTeam.Name"
            style="width:80px;height:80px;object-fit:contain;"
            onerror="this.onerror=null;this.src='@Url.Content("~/images/logos/default.png")';" />

        <h1 class="mb-0 text-warning">@Model.HomeTeam.Name</h1>
        <span class="text-secondary">vs</span>
        <h1 class="mb-0 text-warning">@Model.AwayTeam.Name</h1>

        <img src="@(Url.Content(Model.AwayTeam.LogoUrl ?? "~/images/logos/default.png"))"
            alt="@Model.AwayTeam.Name"
            style="width:80px;height:80px;object-fit:contain;"
            onerror="this.onerror=null;this.src='@Url.Content("~/images/logos/default.png")';" />
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-4">
            <div class="small text-uppercase text-secondary">Ligue</div>
            <div class="fw-semibold">@Model.League.Name</div>
        </div>
        <div class="col-md-4">
            <div class="small text-uppercase text-secondary">Quand</div>
            <div class="fw-semibold">@Model.StartAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</div>
        </div>
        <div class="col-md-4">
            <div class="small text-uppercase text-secondary">Lieu</div>
            <div class="fw-semibold">@Model.Venue</div>
        </div>
    </div>

<hr class="border-warning opacity-50" />

@if (!User.Identity.IsAuthenticated)
{
    <div class="alert alert-info">Connecte-toi pour r√©server ce match (1 coin).</div>
    <a class="btn btn-warning" asp-area="" asp-controller="Account" asp-action="Login">Se connecter</a>
}
else if (!hasAccess)
{
    <form method="post" asp-action="BuyAccess" asp-route-id="@Model.Id">
        <button class="btn btn-warning">üéüÔ∏è R√©server ma place (1 coin)</button>
    </form>
    <div class="text-secondary mt-2">
        Diffusion √† partir du @Model.StartAt.ToLocalTime().ToString("dd/MM/yyyy HH:mm")
    </div>
}
else
{
    if (canWatchNow)
    {
        <div class="alert alert-success">R√©servation confirm√©e ‚úî La diffusion est disponible.</div>
        <a class="btn btn-success" asp-action="Watch" asp-route-id="@Model.Id">Regarder le match</a>
    }
    else
    {
        <div class="alert alert-success">R√©servation confirm√©e ‚úî</div>
        <div class="text-secondary">La diffusion ouvrira le @canWatchFromLocal.ToString("dd/MM/yyyy HH:mm").</div>

        <button id="watchBtn" class="btn btn-success mt-2" disabled>Regarder le match</button>

        <div id="countdown" class="text-warning mt-2 fw-bold"></div>

        <script>
            (function(){
              const target = new Date('@canWatchFromLocal.ToString("yyyy-MM-ddTHH:mm:ss")');
              const btn = document.getElementById('watchBtn');
              const cd = document.getElementById('countdown');

              function tick(){
                const now = new Date();
                const diff = target - now;
                if (diff <= 0){
                  btn.disabled = false;
                  btn.onclick = () => { window.location = '@Url.Action("Watch","Games", new { id = Model.Id })'; };
                  cd.textContent = "C'est parti !";
                  clearInterval(intv);
                } else {
                  const s = Math.floor(diff/1000)%60;
                  const m = Math.floor(diff/60000)%60;
                  const h = Math.floor(diff/3600000);
                  cd.textContent = `Disponible dans ${h}h ${m}m ${s}s`;
                }
              }
              tick();
              const intv = setInterval(tick, 1000);
            })();
        </script>
    }
}



    <div class="text-center mt-4">
        <a class="btn btn-outline-warning" asp-controller="Home" asp-action="Index">‚¨Ö Retour √† l‚Äôaccueil</a>
    </div>
</div>
